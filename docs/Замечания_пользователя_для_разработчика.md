# Замечания пользователя — сводка для разработчика

*Дата: 13.02.2025*  
*Источник: Претензии, Аудит ТЗ, Отчёт агентов, План доведения*

---

## 1. Список проблем с приоритетом

### P0 — Критичные (блокируют работу в поле)

| # | Проблема | Ожидаемое поведение | Критерий «исправлено» |
|---|----------|---------------------|------------------------|
| P0-1 | Трек не записывается / не сохраняется / не отображается | При СТАРТ точки пишутся в БД (скорость >0.5 км/ч), при СТОП сессия сохраняется, трек виден в истории и на карте | Точки в БД, полоса на карте, сохранение после перезапуска |
| P0-2 | Ширина полосы не соответствует заданной | Полоса = widthMeters из AB-линии, площадь = путь × ширина / 10000 | Ввод ширины при создании линии, полоса на карте = widthMeters |
| P0-3 | Цвет заливки — жёлтый вместо зелёного | Полупрозрачный зелёный #4CAF50 (30–40%), граница белая/чёрная | Заливка зелёная, граница читаемая |

### P1 — Важные (влияют на удобство)

| # | Проблема | Ожидаемое поведение | Критерий «исправлено» |
|---|----------|---------------------|------------------------|
| P1-1 | Лаги при длинных треках (5000+ точек) | Карта отзывчива, нет фризов при 1 Гц GPS | При 5000+ точках карта не тормозит; упрощение трека (Douglas–Peucker) |
| P1-2 | Дёрганье / «телепортация» карты и трактора | Плавное отображение без резких скачков | Интерполяция/Lerp, animateCamera вместо moveCamera |
| P1-3 | Нет пунктирной линии по центру полосы | По центру полосы — пунктирная линия | Пунктир виден на карте |
| P1-4 | Нет кнопок «+» / «−» для масштаба | Жест щипок и/или кнопки (ТЗ 5.8) | Кнопки масштаба на карте |
| P1-5 | Нет кнопки «Найти меня» при выключенном follow | Отдельная кнопка центрирования | Кнопка центрирования при follow=false |
| P1-6 | Нельзя открыть старый трек на карте | В истории — tap по сессии → карта с этим треком | Tap по сессии открывает карту с треком |

### P2 — Средние (полировка)

| # | Проблема | Ожидаемое поведение | Критерий «исправлено» |
|---|----------|---------------------|------------------------|
| P2-1 | «Поделиться» не работает на web | Экспорт GPX/CSV/KML на всех платформах | Нет MissingPluginException на web |
| P2-2 | GPS: нет фильтра по времени (>3 с) и скачку (>10 м/с) | Игнорировать старые точки и аномальные скачки | Фильтры в location_service |
| P2-3 | Шкала отклонения <30% ширины | Шкала ≥30% ширины (ТЗ 2.1) | LayoutBuilder, minWidth |
| P2-4 | Нет переключателя слоёв (трек / AB / параллели) | Опционально: чекбоксы или кнопки | Слои включаются/выключаются |

### P3 — Низкие / опционально

| # | Проблема | Ожидаемое поведение | Критерий «исправлено» |
|---|----------|---------------------|------------------------|
| P3-1 | Переключатель проходов (AB, +1, -1) — непривычно для новичка | Подсказка или упрощение | Подсказка при первом использовании |
| P3-2 | История работ — переход через нижнюю панель не очевиден | Более заметная навигация | Улучшенная навигация или подсказка |
| P3-3 | Количество спутников не отображается | GpsStatus показывает satelliteCount | Передача satelliteCount (если API даёт) |

---

## 2. Карта / трек / производительность / UI — кратко

| Область | Что не так | Что нужно |
|---------|------------|-----------|
| **Карта** | Дёрганье, телепортация, нет кнопок +/−, нет «Найти меня» при follow=false | Плавность (Lerp, animateCamera), кнопки масштаба, кнопка центрирования |
| **Трек** | Цвет жёлтый, нет пунктирной линии по центру, ширина не применяется | Зелёный #4CAF50, пунктир по центру, widthMeters |
| **Производительность** | Лаги при 5000+ точках | Упрощение трека (Douglas–Peucker), throttle обновлений |
| **Понятность UI** | Шкала <30%, история неочевидна, переключатель проходов непривычен | Шкала ≥30%, подсказки, навигация |

---

## 3. Уже исправлено (13.02.2025)

- Камера по направлению движения (bearing в follow)
- Цвет трека зелёный
- Трактор — треугольник с направлением
- Штанга по направлению за трактором
- Плавное отображение (Lerp, animateCamera)
- «Поделиться» на web (условная компиляция)

---

## 4. Промпты для subagent

```
P0-1: «Доведи запись и отображение трека до рабочего состояния. dart analyze + flutter test.»

P0-2: «Ширина захвата: полоса = widthMeters из AB-линии. Площадь = путь × ширина / 10000.»

P0-3: «Цвет заливки полосы: зелёный #4CAF50 (30–40%), граница белая/чёрная.»

P1-1: «При 5000+ точках карта не должна тормозить. Упрощение геометрии, throttle.»

P1-2: «Пунктирная линия по центру полосы трека (ТЗ 5.2).»

P1-4: «Кнопки +/− для масштаба карты.»

P1-5: «Кнопка «Найти меня» при выключенном follow.»

P1-6: «Tap по сессии в истории → открыть карту с этим треком.»
```
